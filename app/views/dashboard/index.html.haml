- paging = (!@posts.nil? and @posts.try(:current_page).present?)

%section.contents-page#posts
  .container
    .row
      = main_column_tag do
        = render 'application/my_home_tab'

        - if current_user.need_to_more_member?(current_group)
          .unified-editor.unified-editor-intro.cursor-default
            .text-muted
              .media
                .media-left
                  = byline current_user, hide_nickname: true
                .media-body
                  #{current_user.nickname}님, 이제 빠띠를 시작해보세요!
                  = link_to '시작하기', dashboard_intro_path, class: 'btn btn-primary'
        - else
          - member_issues = current_user.member_issues.order(:title)
          .unified-editor.unified-editor-intro.js-unified-editor-intro
            .text-muted
              = byline current_user, hide_nickname: true
              .placeholder #{current_user.nickname}님, 무슨 이야기를 나누실래요?

        .unified-editor.unified-editor--hidden.js-unified-editor.js-parti-editor-selector-wrapper{ data: { action: ('parti-post-editor-spotlight' if !is_small_screen?) } }
          = render 'posts/issue_selector'

          - unless current_user.need_to_more_member?(current_group)
            = render 'posts/new_form', issue: nil

        .js-invisible-on-mobile-editing
          - if params[:q].blank?
            = render 'posts/new_posts_count', new_posts_count_url: new_dashboard_posts_count_path(last_time: DateTime.now.to_i)

          .posts{data: {last_id: -1, is_last: 'false'}}
            - if params[:q].present?
              .post-card.summary
                .post-card__post
                  - if @search_q.present?
                    내 피드에서 "#{@search_q}"을(를) 검색한 결과입니다.
                    - if @search_q != params[:q]
                      영문과 한글만 검색합니다.
                    = link_to '취소', dashboard_path, class: 'btn btn-sm btn-default'
                  - elsif @hashtag.present?
                    내 피드에서 "##{@hashtag}" 해시태그된 게시물입니다.
                    %span.text-nowrap
                      = link_to '취소', dashboard_path, class: 'btn btn-sm btn-default'
                      = link_to hashtag_url(subdomain: nil, hashtag: @hashtag), class: 'btn btn-sm btn-default' do
                        모든 빠띠에서 찾아보기
                        %i.fa.fa-arrow-right
                  - else
                    = form_tag dashboard_path, method: :get do
                      .form-group.has-feedback
                        = search_field_tag :q, params[:q], placeholder: '게시글 찾기...', class: 'form-control'
                        %span.form-control-feedback{ style: 'pointer-events: initial;' }
                          = button_tag class: 'btn btn-link btn-xs' do
                            %i.fa.fa-search.text-muted
                    각 단어가 두 글자 이상은 되어야 검색됩니다. 검색할 키워드를 다시 입력하세요.

            #no-data.text-center.alert{ style: ('display: none;' if !paging or @posts.any?) }
              %i.fa.fa-info-circle
                - if params[:q].blank?
                  게시글이 없습니다.
                - else
                  검색 결과가 없습니다.
            - if paging
              = render 'posts/page', posts: @posts, show_issue: true, show_day_section: true, first_today_text: ("게시물 #{number_with_delimiter @posts.total_count}개 중에 #{@posts.current_page}페이지를 표시합니다" unless @posts.first_page?)

          - if paging
            = paginate @posts, theme: 'catan'

            - if @recommend_posts.any?
              %hr

              .post-data-divider 다른 빠띠에선 이런 이야기를 나누고 있어요
              = render 'posts/list_card', posts: @recommend_posts.limit(30).to_a.sample(3)


          - else
            .page-waypoint.js-page-waypoint-onload.text-center{ 'data-target': '.posts', 'data-url': dashboard_path(format: :js, q: params[:q]) }
              .page-waypoint-loading.js-page-waypoint-loading
                %i.fa.fa-2x.fa-spinner.fa-pulse
      - unless is_small_screen?
        = render 'application/aside'
