- paging = (!@posts.nil? and @posts.try(:current_page).present?)

= render 'issues/issue_header', active_tab: :home, simple: (paging and !@posts.first_page?)

%section.contents-page#posts
  .container
    .row
      = main_column_tag do
        - if !@issue.frozen?
          - if user_signed_in?
            - if @issue.member?(current_user)
              - if @issue.postable?(current_user)
                .unified-editor.unified-editor-intro.js-unified-editor-intro
                  .text-muted
                    = byline current_user, hide_nickname: true
                    .placeholder #{current_user.nickname}님, 무슨 이야기를 나누실래요?
                .unified-editor.unified-editor--hidden.js-unified-editor
                  = render 'posts/new_form', issue: @issue
            - elsif @issue.member_requested?(current_user)
              .unified-editor.unified-editor--join
                오거나이저의 가입승인을 기다려주세요.
            - else
              - if @issue.notice_only?
                .unified-editor.unified-editor--join
                  이 빠띠에 가입하여 새소식을 들어보세요.
                  = render 'issues/join_button'
              - else
                .unified-editor.unified-editor--join
                  이 빠띠에 가입하여 게시물을 올려보세요.
                  = render 'issues/join_button'
          - else
            .unified-editor.unified-editor-intro{data: { toggle: 'parti-login-overlay' }}
              .text-muted
                지금 이야기를 시작해 보세요.
                %i.fa.fa-sign-in
        - else
          .unified-editor.unified-editor-intro
            .text-muted.text-primary
              휴면 중인 빠띠입니다.

        .js-invisible-on-mobile-editing
          - if params[:q].blank?
            = render 'posts/new_posts_count', new_posts_count_url: new_issue_posts_count_url(issue_id: @issue.id, last_time: DateTime.now.to_i)

          .posts{data: {last_id: -1, is_last: 'false'}}
            - if params[:q].present?
              .post-card.summary
                .post-card__post
                  - if @search_q.present?
                    "#{@search_q}"을(를) 검색한 결과입니다.
                    - if @search_q != params[:q]
                      영문과 한글만 검색합니다.
                    = link_to '취소', smart_issue_home_path_or_url(@issue), class: 'btn btn-sm btn-default'
                  - else
                    = form_tag smart_issue_home_path_or_url(@issue), method: :get do
                      .form-group.has-feedback
                        = search_field_tag :q, params[:q], placeholder: '게시글 찾기...', class: 'form-control'
                        %span.form-control-feedback{ style: 'pointer-events: initial;' }
                          = button_tag class: 'btn btn-link btn-xs' do
                            %i.fa.fa-search.text-muted
                    각 단어가 두 글자 이상은 되어야 검색됩니다. 검색할 키워드를 다시 입력하세요.
            - unless @search_q.present?
              = render 'posts/list_pinned', posts: @posts_pinned, compact: true

            - unless @issue.member_requested?(current_user)
              #no-data.text-center.alert{ style: ('display: none;' if !paging or @posts.any?) }
                %i.fa.fa-info-circle
                  - if params[:q].blank?
                    게시글이 없습니다.
                  - else
                    검색 결과가 없습니다.

            - if paging
              = render 'posts/page', posts: @posts, show_issue: false, show_day_section: true, first_today_text: ("게시물 #{number_with_delimiter @posts.total_count}개 중에 #{@posts.current_page}페이지를 표시합니다" unless @posts.first_page?)

          - unless @issue.member_requested?(current_user)
            - if paging
              = paginate @posts, theme: 'catan'

              - if @recommend_posts.any?
                %hr

                .post-data-divider 다른 빠띠에선 이런 이야기를 나누고 있어요
                = render 'posts/list_card', posts: @recommend_posts.limit(30).to_a.sample(3)
            - else
              .page-waypoint.js-page-waypoint-onload.text-center{'data-target': '.posts', 'data-url': smart_issue_home_path_or_url(@issue, format: :js, q: params[:q])}
                .page-waypoint-loading.js-page-waypoint-loading
                  %i.fa.fa-2x.fa-spinner.fa-pulse
      - unless is_small_screen?
        = render 'issues/aside'
