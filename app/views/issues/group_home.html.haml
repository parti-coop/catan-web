- if request.query_string.blank?
  - if current_group.key_visual_background_image.present? or current_group.key_visual_foreground_image.present?
    %section.group-key-visual{ class: ('group-key-visual-only-bg' if (current_group.key_visual_background_image.present? and current_group.key_visual_foreground_image.blank?)), style: ("background-image: url(#{asset_url(current_group.key_visual_background_image)});" if current_group.key_visual_background_image.present?) }
      - if current_group.key_visual_foreground_image.present?
        = image_tag current_group.key_visual_foreground_image.url, style: "width: 100%"

  = render_group_only_exist "key_page"

- paging = (!@posts.nil? and @posts.try(:current_page).present?)
- is_first_page_in_paging = (paging and @posts.first_page?)
= render 'application/group_home_sub_header', active: 'home'

- if Issue.only_alive_of_group(current_group).any?
  %section#home{ style:"padding-bottom: 40px;" }
    - if current_group.front_wiki_post.present? and !current_group.front_wiki_post.private_blocked?(current_user) and (@recent_posts.try(:current_page) || 0) <= 1
      .container.container-xs-full-width
        %section.front-wiki
          .post-card
            .post-card__post
              .post-line
                .post-body
                  = render 'wikis/card', post: current_group.front_wiki_post, mode: 'preview-detail', hide_last_stroked_for: true

    - home_components_content = capture do
      - current_group.group_home_components.sequenced.each do |group_home_component|
        - if (@recent_posts.try(:current_page) || 0) <= 1
          - if group_home_component.format_name.updated_issues?
            = render 'issues/group_home_updated_issues', title: group_home_component.title
          - if group_home_component.format_name.issue_posts?
            = render 'issues/group_home_issue_posts', title: group_home_component.title, issue: group_home_component.issue_posts_format.issue
        - if group_home_component.format_name.all_posts?
          = render 'issues/group_home_all_posts', recent_posts: @recent_posts, title: group_home_component.title

    - if home_components_content.try(:strip).present?
      .container= home_components_content
    - else
      .container
        - if (@recent_posts.try(:current_page) || 0) <= 1
          = render 'issues/group_home_updated_issues'

          - if @discussions.any?
            %section{ style:"margin-top:20px;" }
              = link_to polls_or_surveys_path do
                %h4.group-heading
                  진행 중인 토론
                  - if @discussions_all.count != @discussions.count
                    %small.text-nowrap
                      모든 #{number_with_delimiter @discussions_all.count}개 토론 보기
                      %i.fa.fa-angle-double-right
              .discussions-all-list.clearfix
                .row.slick-slider.slick-slider-catan.slick-slider-recent-polls-and-surveys{ data: { 'slick-slider-lg': 3, 'slick-slider-md': 3, 'slick-slider-xs': 1, 'auto-height': 'true' } }
                  = render 'posts/page_card', posts: @discussions, sm_columns_count: 3, compact: false, show_last_stroked_for: true, show_decision: true

        = render 'issues/group_home_all_posts', recent_posts: @recent_posts
- else
  %section#home
    .container
      .row
        = main_column_tag do
          %section{style:"margin-top:20px; padding-bottom: 10px"}
            %h4.group-heading #{current_group.title} 그룹에 오신 것을 환영합니다.
          .bg-default
            - if current_group.creatable_issue?(current_user)
              %p 가장 먼저 채널을 개설해 보세요.

              .fa.fa-info-circle
              = link_to new_issue_path, class: 'text-primary' do
                채널 만들기
                %i.fa.fa-arrow-right
            - else
              %p
                .fa.fa-info-circle
                개설 준비 중입니다.

        = render 'issues/group_home_aside'
