- issue ||= local_assigns[:card]
- if issue.watched_by?(current_user)
  - action_link = issue.member_only? ? cancel_issue_members_path(issue, partial: :intro) : cancel_issue_watches_path(issue, partial: :intro)
  - action_method = :delete
- else
  - action_link = issue.member_only? ? issue_members_path(issue, partial: :intro) : issue_watches_path(issue, partial: :intro)
  - action_method = :post
.issue-card.issue-card--intro{class: "#{dom_id(issue)}-card #{'issue-card--watched' if issue.watched_by?(current_user)}"}
  = link_to action_link, method: action_method, remote: true do
    .issue-card-cover
    .issue-card__thumb.img-circle{ style: "background-image: url(#{issue.logo.sm.url});" }
      - if issue.on_group? and current_group != issue.group
        .issue-card__group
          = issue.group.name
      .issue-card__thumb__btn
    .issue-card__content
      .issue-card__title
        .issue-card__title__text-wrapper
          .issue-card__title__text{"data-action": "parti-ellipsis", title: issue.title, style: ("word-break: keep-all;" if issue.title[0..5].match(/\s/))}= issue.title
      .issue-card__body.hidden-xs{"data-action": "parti-ellipsis", title: issue.body}= excerpt(issue.body, length: 60)
      .issue-card__meta
        %span.user-count
          %i.fa.fa-user
          %b= issue.watches.count
        %span.comment-count
          %i.fa.fa-comment
          %b= issue.comments.count

