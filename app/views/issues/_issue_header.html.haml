- issue ||= @issue
- active_tab ||= nil
%section.parti-header-section
  - geo_pattern_background = capture do
    .parti-black-layer{ style: "background-image: #{GeoPattern.generate(issue.title, base_color: '#2a164b').to_data_uri};" }
  - logo_background = capture do
    .parti-black-layer{ style: "background-color: #777;" }
      %svg#blurred_i89pasu2y.bg-blur{height: "100%", width: "100%", preserveAspectRatio: "xMidYMid slice", version: "1.1", xmlns: "http://www.w3.org/2000/svg"}
        %filter#parti-header-blur-background
          %fegaussianblur{in: "SourceGraphic", stdDeviation: "20"}
        %image{externalResourcesRequired: "true", height: "100%", width: "100%", preserveAspectRatio: "xMidYMid slice", style: "filter:url(#parti-header-blur-background)", x: "0", y: "0", "xlink:href": issue.logo.md.url, "xmlns:xlink": "http://www.w3.org/1999/xlink"}
  - if issue.logo.present? and (browser.ie?(">9") or !browser.ie?)
    = logo_background
  - else
    = geo_pattern_background
  .container
    .media
      .media-left
        .parti-logo
          = link_to issue_home_path(issue) do
            .thumb{style: "background-image: url(#{issue.logo.md.url})"}
      .media-body
        %h2.parti-title
          = issue.title
        .row
          .col-xs-12.col-sm-9
            .parti-body
              = issue.body
            .parti-info.visible-xs-block
              %span.parti-makers-label 빠띠메이커
              %span.parti-maker-icons
                - issue.makers.each do  |maker|
                  = byline maker.user, hide_nickname: true
              = link_to issue_users_path(issue) do
                %span.parti-users-label 구독회원
                %span.parti-users-count= issue.watched_users.count
            .parti-buttons
              %span.parti-watch-button
                = render 'watches/watch', issue: issue, cancel_btn_class: 'btn btn-xs btn-ghost', watch_btn_class: 'btn btn-xs btn-primary', maker_class: 'hidden'
              %span.parti-admin-buttons
                - if can? :update, issue
                  = link_to '수정', [:edit, issue], class: 'btn btn-ghost btn-xs'
                - if can? :destroy, issue
                  = link_to '삭제', issue, method: :delete, data: { confirm: '정말 삭제하시겠습니까?' }, class: 'btn btn-ghost btn-xs'
          .col-sm-3.text-right.hidden-xs
            - data = {action: 'parti-share', 'share-url': issue_home_url(issue), 'share-text': "#{issue.title} | 빠띠" }
            - map = { facebook: data }
            - map.update twitter: data, 'kakao-link': data, 'kakao-story': data
            = render 'application/share', map: map

  .parti-menu
    - counts_container = issue.counts_container
    .container
      .row
        .col-sm-7.col-xs-12
          .row
            .col-xs-2.col-sm-2{ class: ('active' if active_tab.nil? || active_tab == :home) }
              = link_to issue_home_path(issue) do
                %h5 홈

            .col-xs-2.col-sm-2{class: ('active' if active_tab == :notes)}
              - count_label = capture_haml(counts_container) do
                %span.count<>
                  = counts_container.notes_count
                  - if counts_container.latest_notes_count > 0
                    %small.text-primary<>
                      +#{counts_container.latest_notes_count}
              = link_to issue_notes_path(issue) do
                %h5
                  = Note.model_name.human
                  %span.hidden-xs= count_label

            .col-xs-2.col-sm-2{class: ('active' if active_tab == :talks)}
              - count_label = capture_haml(counts_container) do
                %span.count<>
                  = counts_container.talks_count
                  - if counts_container.latest_talks_count > 0
                    %small.text-primary<>
                      +#{counts_container.latest_talks_count}
              = link_to issue_talks_path(issue) do
                %h5
                  = Talk.model_name.human
                  %span.hidden-xs= count_label

            .col-xs-2.col-sm-2{class: ('active' if active_tab == :opinions)}
              - count_label = capture_haml(counts_container) do
                %span.count<>
                  = counts_container.opinions_count
                  - if counts_container.latest_opinions_count > 0
                    %small.text-primary<>
                      +#{counts_container.latest_opinions_count}
              = link_to issue_opinions_path(issue) do
                %h5
                  = Opinion.model_name.human
                  %span.hidden-xs= count_label

            .col-xs-2.col-sm-2{class: ('active' if active_tab == :articles)}
              - count_label = capture_haml(counts_container) do
                %span.count<>
                  = counts_container.articles_count
                  - if counts_container.latest_articles_count > 0
                    %small.text-primary<>
                      +#{counts_container.latest_articles_count}
              = link_to issue_articles_path(issue) do
                %h5
                  = Article.model_name.human
                  %span.hidden-xs= count_label

            .col-xs-2.col-sm-2{class: ('active' if active_tab == :wikis)}
              - count_label = capture_haml(counts_container) do
                %span.count 베타
              = link_to issue_wikis_path(issue) do
                %h5
                  = Wiki.model_name.human
                  %span.hidden-xs= count_label

= render 'issues/bottom_banner'

