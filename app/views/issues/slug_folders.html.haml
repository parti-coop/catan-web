= render 'issues/issue_header', active_tab: :folders

%section#folders
  .container
    - if @folders.blank?
      .bg-default.text-center
        %i.fa.fa-info-circle
        폴더로 게시글을 정리해 보세요.
        %br
          각 게시글
          "상세 메뉴
          %i.fa.fa-ellipsis-v
          "에서 폴더를 만들 수 있습니다.
    - else
      - if @current_folder.blank?
        .contents-header
          %h4.contents-header__title
            %i.fa.fa-folder-open-o
            모든 폴더
            %small 빠띠의 모든 폴더입니다.
        - unless @folders.blank?
          %ul.list-unstyled.threaded-folders
            - Folder.threaded(@folders).each do |parent_folder, child_folders|
              %li.parent-folder.parent-folder-margined
                = link_to smart_folder_url(parent_folder) do
                  - if child_folders.any?
                    %i.fa.fa-folder-open
                  - else
                    %i.fa.fa-folder
                  = parent_folder.title
                - child_folders.each do |child_folder|
                  %ul.list-unstyled.child-folders
                    %li.child-folder
                      = link_to smart_folder_url(child_folder) do
                        %i.fa.fa-folder
                        = child_folder.title
        - else @folders.blank?
          .bg-default.text-center
            %i.fa.fa-info-circle
            폴더가 없습니다.
      - else
        .contents-header
          %h4.contents-header__title
            = link_to smart_issue_folders_path(@issue) do
              %i.fa.fa-folder-o
              모든 폴더
            \/
            %span.dropdown{ style: 'position: relative;'}
              %span.dropdown-toggle.cursor-pointer.hover-text-primary{ "aria-expanded": "false", "aria-haspopup": "true", "data-toggle": "dropdown" }
                = @current_folder.title
                %small
                  (#{@current_folder.posts.count})
                  %i.fa.fa-chevron-down
              %ul.dropdown-menu.threaded-folders.pull-right{ "aria-labelledby": 'more-hashtag' }
                - if @issue.folders.where.not(id: @current_folder.id).any?
                  %li.dropdown-header 다른 폴더로 이동
                  - Folder.threaded(@issue.folders).each do |parent_folder, child_folders|
                    %li.parent-folder.clearfix
                      = link_to smart_folder_url(parent_folder) do
                        = parent_folder.title
                        - if parent_folder == @current_folder
                          %i.fa.fa-check.pull-right
                    - child_folders.each do |child_folder|
                      %li.child-folder.clearfix
                        = link_to smart_folder_url(child_folder) do
                          = child_folder.title
                          - if child_folder == @current_folder
                            %i.fa.fa-check.pull-right
                  %li.divider
                %li.dropdown-header "#{@current_folder.title}" 폴더 관리
                %li
                  = link_to [:edit, @current_folder], remote: true, class: 'text-nowrap' do
                    수정
                %li
                  = link_to @current_folder, method: :delete, data: { confirm: '정말 삭제하시겠습니까?' }, class: 'text-nowrap' do
                    삭제
          .posts-filter-select
            = render 'posts/sort_select'
        - if @posts.any?
          .row.masonry-container{ data: { 'masonry-grid-sizer': '.grid-sizer' } }
            .grid-sizer.col-sm-4.col-xs-6
            = render 'posts/page_card', posts: @posts
        - else
          .bg-default.text-center
            %i.fa.fa-info-circle
            해당 폴더는 비었습니다.

        = paginate @posts, theme: 'catan'

= render 'issues/bottom_banner', issue: @issue
