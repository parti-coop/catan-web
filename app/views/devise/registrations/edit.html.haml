- user_edit_block_dom_id = "user-edit-block-#{SecureRandom.uuid}"
- push_notification_preference_toggle_class_name = "push-notification-preference-toggle-#{SecureRandom.uuid}"

%section.user-edit-block{ id: user_edit_block_dom_id }
  %h3.user-edit-block__title 프로필
  .user-edit-block__form
    = form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f|
      = devise_error_messages!
      .form-group.text-center
        - if f.object.read_attribute(:image).present?
          = image_tag f.object.image_url, class: 'img-circle circle-140'
      .form-group
        = f.label :nickname
        = f.text_field :nickname, class: 'form-control'
      .form-group
        = f.label :email
        = f.email_field :email, autofocus: true, class: 'form-control'
        - if devise_mapping.confirmable? && resource.pending_reconfirmation?
          %div
            확인을 기다리고 있습니다.: #{resource.unconfirmed_email}
      .form-group
        = f.label :image
        = f.file_field :image, autofocus: true, class: 'form-control'
        = f.hidden_field :image_cache
        - if f.object.read_attribute(:image).present?
          %label{ style: 'font-weight: normal; margin-top: 6px' }
            = f.check_box :remove_image
            삭제하기
      .form-group
        = f.label :enable_mailing
        .checkbox
          %label
            = f.check_box :enable_mailing_mention
            나를 멘션한 게시글이나 댓글을 이메일로 받습니다.
        .checkbox
          %label
            = f.check_box :enable_mailing_pin
            공지를 이메일로 받습니다.
        .checkbox
          %label
            = f.check_box :enable_mailing_poll_or_survey
            설문이나 투표의 진행 사항을 이메일로 받습니다.
        .checkbox
          %label
            = f.check_box :enable_mailing_member
            오거나이저인 빠띠에 신규 멤버가 가입한 경우 이메일을 받습니다.
        .checkbox
          %label
            = f.check_box :enable_mailing_summary
            가입한 빠띠의 소식과 가입된 그룹의 새로 열린 빠띠 소식을
            이메일로 받습니다.

      .form-group
        - push_notification_mode_options = User.push_notification_mode.options.map { |option| (option[1] == "off" ? option << { data: { 'js-toggle-select-hide': ".#{push_notification_preference_toggle_class_name}" } } : option << { data: { 'js-toggle-select-show': ".#{push_notification_preference_toggle_class_name}" } } ) }
        = f.label :push_notification_mode
        = f.select :push_notification_mode, push_notification_mode_options, {}, class: 'form-control js-toggle-select', data: { 'toggle-select-container': "##{user_edit_block_dom_id}" }

        %p.help-text{ class: "#{push_notification_preference_toggle_class_name} #{'collapse' if resource.push_notification_mode.off?}" }<>
          - if resource.issue_push_notification_preferences.any?
            %span<>
              = link_to '#anchor-issue-push-notification-preferences', class: 'text-primary' do
                빠띠별 앱 알림 설정
                #{resource.issue_push_notification_preferences.count}개
            %span<> 가 있습니다.
          - else
            %span<>
              = link_to new_issue_push_notification_preference_path, remote: true, data: { disable_with: '(새 창을 여는 중...)' }, class: 'text-primary' do
                빠띠별로 앱 알림 설정
            %span<> 을 해보세요.
      - if resource.provider == 'email'
        %hr
        .form-group
          = f.label :password
          %small.help-block 변경하지 않으시려면 비워두세요
          = f.password_field :password, autocomplete: "off", class: 'form-control'
        .form-group
          = f.label :password_confirmation
          = f.password_field :password_confirmation, autocomplete: "off", class: 'form-control'
        .form-group
          = f.label :current_password
          %small.help-block 보안을 위해 현재 비밀번호를 입력해 주세요
          = f.password_field :current_password, autocomplete: "off", class: 'form-control'
        %hr
      = f.submit '저장', class: 'btn btn-primary btn-block', data: { disable_with: "저장 중..." }


  %div{ class: "#{push_notification_preference_toggle_class_name} #{'collapse' if resource.push_notification_mode.off?}" }
    %hr

    %a.anchor#anchor-issue-push-notification-preferences
    .user-issue-push-notification-preferences
      %label 빠띠별 앱 알림 설정
      %br
      빠띠마다 앱 알림 규칙을 설정합니다.
      %br
      = link_to new_issue_push_notification_preference_path, remote: true, class: 'btn btn-default', data: { disable_with: '잠시만 기다려 주세요...' }, style: 'margin-top: 6px' do
        새로운 설정 추가 +

      .user-issue-push-notification-preferences.js-user-issue-push-notification-preferences
        = render 'issue_push_notification_preferences/list'

  %hr

  .user-cancel
    %label
      회원탈퇴
    %br
    탈퇴를 원하시면
    = link_to 'help@parti.xyz', 'mailto:help@parti.xyz'
    로 회원의 이메일과 닉네임을 적어 보내주시기 바랍니다.

