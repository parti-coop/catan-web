- if Group.comprehensive_joined_by(current_user).any?
  - ([host_group] + Group.sort_by_name.comprehensive_joined_by(current_user).but(host_group).to_a).each do |menu_group|
    - divider_dom_id = "js-more-sidemenu-divider-#{SecureRandom.uuid}"
    %li.divider.divider-small{ id: divider_dom_id }
    %li.group-issues-line.js-drawer-filter-item.js-drawer-filter-group
      .title.cursor-pointer.js-my-menu-searchable-group-line{ data: { 'action': "parti-link", 'url': smart_group_url(menu_group) } }
        - latest_issues_count = menu_group.visiable_latest_issues_count
        - latest_stroked_posts_count = menu_group.visiable_latest_stroked_posts_count
        - any_latest_issues = (!latest_issues_count.nil? and latest_issues_count > 0)
        - any_latest_stroked_posts = (!latest_stroked_posts_count.nil? and latest_stroked_posts_count > 0)

        = link_to smart_group_url(menu_group, sort: :order_by_stroked_at, anchor: ('js-group-all-posts' if !menu_group.indie? and !any_latest_issues and any_latest_stroked_posts)), 'aria-label': only_mobile_app(request, "drawer-group-#{menu_group.slug}") do
          .group-parties-section-title-wrapper
            #{group_my_parties_section_title(menu_group)}
            - if any_latest_issues
              %span.parties-count
                %i.fa.fa-flag(title='최근 빠띠')
                = latest_issues_count
            - unless menu_group.indie?
              - if any_latest_stroked_posts
                %span.posts-count
                  %i.fa.fa-file-text(title='최근 업데이트')
                  = latest_stroked_posts_count
      - issues = current_user.member_issues.only_alive_of_group(menu_group)

      - if issues.any?
        %ul.sub.list-unstyled
          - magic_count = 2

          - if issues.count < magic_count * 2
            - issues.sort_by_name.each do |issue|
              = render 'issues/issue_line', issue: issue, link_whole_line: true, show_after_block: false, issue_classes: "js-my-menu-searchable-line"

          - else
            - fixed_issues = []

            - fixed_issues = issues.only_my_menu(current_user).to_a
            - issues = issues.where.not(id: fixed_issues)

            - if fixed_issues.count < magic_count
              - recent_joined_issues = issues.where(id: current_user.issue_members.past_week.recent.limit(magic_count).to_a)
              - fixed_issues = fixed_issues + recent_joined_issues.to_a
              - issues = issues.where.not(id: recent_joined_issues)

            - if fixed_issues.count < magic_count
              - hot_issues = issues.hottest.limit(magic_count)
              - fixed_issues = fixed_issues + hot_issues.to_a
              - issues = issues.where.not(id: hot_issues.to_a)

            - Issue.where(id: fixed_issues).sort_by_name.each do |issue|
              = render 'issues/issue_line', issue: issue, link_whole_line: true, show_after_block: false, issue_classes: "js-my-menu-searchable-line"

            - if issues.any?
              %li.js-my-menu-searchable-line.js-issue-line-control.issue-more.clearfix
                %a.js-show-more-sidemenu-issues(href="#")
                  %i.fa.fa-caret-down
                  더 보기
                = link_to my_menus_issues_url(subdomain: nil, group_slug: menu_group.slug), class: 'pull-right' do
                  %i.fa.fa-gear
                  설정

              - issues.sort_by_name.each do |issue|
                = render 'issues/issue_line', issue: issue, link_whole_line: true, show_after_block: false, issue_classes: "js-my-menu-searchable-line collapse js-more-sidemenu-collapse"

              %li.js-issue-line-control.issue-less.collapse.js-more-sidemenu-collapse.clearfix
                %a.js-show-less-sidemenu-issues{ href: "##{divider_dom_id}" }
                  %i.fa.fa-caret-up
                  접기
                = link_to my_menus_issues_url(subdomain: nil, group_slug: menu_group.slug), class: 'pull-right' do
                  %i.fa.fa-gear
                  설정
      - else
        %ul.sub.list-unstyled
          %li.js-issue-line.js-issue-line-control
            = link_to smart_group_issues_url(menu_group), style: 'color: #c0c0c2' do
              %span.text-nowrap
                내 빠띠가 없습니다.
              %span.text-nowrap
                가입하기
                %i.fa.fa-arrow-right
