#new-theme-site-header
  %nav.navbar.navbar-default.navbar-fixed-top
    .container
      .navbar-header.navbar-header-center
        %button.navbar-toggle.collapsed{"data-target": "#collapsable", "data-toggle": "collapse", type: "button"}
          %span.icon-bar
          %span.icon-bar
          %span.icon-bar
        %a.navbar-brand{ href: root_path }
          %img{ alt: 'parti', src: asset_path('parti_logo_purple.png')}

      #collapsable.collapse.navbar-collapse
        %ul.nav.navbar-nav.navbar-left
          %li= link_to '빠띠 찾기', home_path, class: "#{'active' if current_page?('/home')}"
          %li.dropdown.general-parties
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              추천 빠띠
              %span.caret
            %ul.dropdown-menu
              - %w(politics economy society nculture education environment labor media).each do |slug|
                = render 'issues/issue_line', issue: Issue.of_slug(slug, nil)
              %li.divider
              = render 'issues/issue_line', issue: Issue.of_slug('parti', nil)
              %li.divider
              - %w(basic-income better-democracy 20th-assembly digital-social-innovation us-presidential-election).each do |slug|
                = render 'issues/issue_line', issue: Issue.of_slug(slug, nil)
          %li.dropdown
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              베스트
              %span.caret
            %ul.dropdown-menu
              - %w(talk opinion article note).each do |model|
                %li= link_to model.classify.safe_constantize.model_name.human, send("#{model.pluralize}_path"), class: "#{'active' if current_page?(controller: "/#{model.pluralize}", action: :index)}"

        %ul.nav.navbar-nav.navbar-right
          - if user_signed_in?
            - if current_user.watches.any?
              %li.dropdown.watch-parties
                %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
                  내 빠띠
                  %span.caret
                %ul.dropdown-menu{data: {'filter': (current_user.watched_issues.count > 12), 'filter-label': '찾으려는 빠띠 이름을 넣어주세요.'}}

                  - if current_user.making_issues.only_group(current_group).any?
                    %li.dropdown-header
                      메이커인 빠띠
                      #{current_user.making_issues.only_group(current_group).count}
                  - current_user.making_issues.only_group(current_group).each do |issue|
                    = render 'issues/issue_line', issue: issue
                  - if current_user.only_watched_or_member_issues(current_group).any?
                    %li.dropdown-header
                      #{current_group.try(:membership?) ? '가입한' : '구독 중인'} 빠띠
                      #{current_user.only_watched_or_member_issues(current_group).count}
                  - current_user.only_watched_or_member_issues(current_group).each do |issue|
                    = render 'issues/issue_line', issue: issue

                  - Group.all_with_indie_and_exclude(current_group).each do |group|
                    - if current_user.making_issues.only_group(group).any?
                      %li.dropdown-header
                        메이커인 #{group.name} 빠띠
                        #{current_user.making_issues.only_group(group).count}
                    - current_user.making_issues.only_group(group).each do |issue|
                      = render 'issues/issue_line', issue: issue
                    - if current_user.only_watched_or_member_issues(group).any?
                      %li.dropdown-header
                        #{group.try(:membership?) ? '가입한' : '구독 중인'} #{group.name} 빠띠
                        #{current_user.only_watched_or_member_issues(group).count}
                    - current_user.only_watched_or_member_issues(group).each do |issue|
                      = render 'issues/issue_line', issue: issue
            %li.notification
              = link_to messages_path, class: "#{'active' if current_page?(controller: '/messages', action: :index)}" do
                - if current_user.unread_messages_count > 0
                  %span.icon-bell-stack
                    %i.fa.fa-circle.fa-stack-1x
                    %i.fa.fa-bell.fa-stack-1x.fa-inverse
                - else
                  %i.fa.fa-bell
                알림

          - if user_signed_in?
            %li.dropdown
              %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
                .thumb.circle-20.img-circle{style: "background-image: url(#{current_user.image.sm.url});"}
                %span.caret
              %ul.dropdown-menu
                %li
                  = link_to user_gallery_path(current_user) do
                    %strong= current_user.nickname
                    프로필
                %li.divider
                %li= link_to '설정', edit_user_registration_path
                %li= link_to '로그아웃', destroy_user_session_path, method: :delete
          - else
            %li.sign-up
              = link_to '로그인/회원가입', new_user_session_path
