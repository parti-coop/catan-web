<% if @parent_comment.blank? %>
  <% more_latest_comments = @post.more_comments %>
  <% has_more = @post.any_not_more_comments? %>
  var comments_html = "";

  <% Comment.group_by_thread(more_latest_comments).each do |parent_comment, child_comments| %>
    comments_html += "<%= j(render 'comments/threaded_comments', parent_comment: parent_comment, child_comments: child_comments) %>";
  <% end %>
  var $comments_html = $(comments_html);
  $('<%= comments_latest_dom_selector(@post) %>').html($comments_html);
  parti_partial$($('<%= comments_latest_dom_selector(@post) %>'), true);

  <% if has_more %>
    $('<%= comments_more_button_dom_selector(@post) %>').attr('href', "<%= smart_post_path_or_url(@post) %>");
    $('<%= comments_more_button_dom_selector(@post) %>').removeAttr('data-remote');
    $('<%= comments_more_button_dom_selector(@post) %>').removeData('remote');
    var $enableWith = $($('<%= comments_more_button_dom_selector(@post) %>').data('ujs:enable-with'));
    $enableWith.find('<%= comments_more_label_dom_selector(@post) %>').text('모든 댓글 보기');
    $('<%= comments_more_button_dom_selector(@post) %>').data('ujs:enable-with', $enableWith.prop('outerHTML'));
    $('<%= comments_more_button_dom_selector(@post) %>').data('disable-with');
  <% else %>
    $('<%= comments_more_button_dom_selector(@post) %>').remove();
  <% end %>
<% else %>
  <% limit = 10 %>
  <% more_latest_comments = @parent_comment.children.limit(limit) %>
  <% has_more = @parent_comment.children.count > limit %>
  var comments_html = '<%= j(render 'comments/child_comments', parent_comment: @parent_comment, child_comments: more_latest_comments) %>';
  var $comments_html = $(comments_html);
  $('<%= comments_children_dom_selector(@parent_comment) %>').html($comments_html);
  parti_partial$($('<%= comments_children_dom_selector(@parent_comment) %>'), true);

  <% if has_more %>
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').attr('href', "<%= smart_post_path_or_url(@post) %>");
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').removeAttr('data-remote');
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').removeData('remote');
    var $enableWith = $($('<%= comments_more_children_button_dom_selector(@parent_comment) %>').data('ujs:enable-with'));
    $enableWith.find('<%= comments_more_children_label_dom_selector(@parent_comment) %>').text('모든 댓글 보기');
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').data('ujs:enable-with', $enableWith.prop('outerHTML'));
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').data('disable-with');
  <% else %>
    $('<%= comments_more_children_button_dom_selector(@parent_comment) %>').remove();
  <% end %>
<% end %>
