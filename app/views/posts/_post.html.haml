- comment_style = local_assigns[:mode] || 'in-list'
.post-card-with-comments{class: "post-card-with-comments--#{comment_style} #{dom_id(post)} #{ 'post-card-with-comments--hidden-issue' unless local_assigns[:show_issue]} #{removable_with_post_dom_class(post) if local_assigns[:mode] == 'list'}", data: { 'parti-comment-style': comment_style }}
  .post-card-with-comments__content
    - if local_assigns[:show_issue]
      .post-card-with-comments__header
        .media
          .media-left
            = link_to smart_issue_home_path_or_url(post.issue) do
              .issue-logo{style: "background-image: url(#{post.issue.logo.xs.url});"}
          .media-body
            = link_to smart_issue_home_path_or_url(post.issue) do
              %span.issue-title
                = post.issue.title
                = security_icon(post.issue)
              - unless post.issue.displayable_group? current_group
                %i.fa.fa-angle-left
                %span.issue-group
                  = post.issue.group.title
                  = security_icon(post.issue.group)
          - if local_assigns[:mode] == 'modal'
            .media-right( style='vertical-align: middle;' )
              %button(type="button" class="close" data-dismiss="modal") &times;

    - if post.private_blocked?(current_user)
      .post-card-with-comments__post
        %strong 비밀빠띠 게시글입니다.
        - if post.issue.member_requested? current_user
          %br
          비밀빠띠를 보시려면 먼저 가입승인 받아야합니다.
          %span
            %strong<> 오거나이저의 가입승인
            을 기다려주세요.
        - else
          이 게시글을 보시려면 먼저 가입신청을 해주세요.
          %span(class="#{dom_id(post.issue)}-member")
            - if user_signed_in?
              = link_to smart_members_or_member_requests_parti_path(post.issue), method: :post, class: 'btn btn-md btn-primary' do
                가입하기
            - else
              = link_to '가입하기', '#', data: { toggle: 'parti-login-overlay', label: '가입', 'after-login': h({action: :issue_member, id: post.issue.id}.to_json) }, class: 'btn btn-md btn-primary'

    - else
      .post-card-with-comments__post
        - chevron_dropdown = capture do
          - if can? :update, post
            %li
              = link_to [:edit, post] do
                수정
          - if can? :destroy, post
            %li
              = link_to post_path(post, mode: local_assigns[:mode]), method: :delete, remote: (local_assigns[:mode] != 'detail'), data: { confirm: '정말 삭제하시겠습니까?' } do
                삭제
          - if can? :pin, post
            %li
              = render 'posts/pin_buttons', post: post
            - if post.pinned?
              %li
                = link_to [:readers, post], target: '_blank' do
                  확인한 가입멤버 보기 (#{post.readers_count})
              %li
                = link_to [:unreaders, post], target: '_blank' do
                  확인하지 않은 가입멤버 보기
          - additional_buttons = capture do
            - if local_assigns[:additional_buttons_partial].present?
              = render additional_buttons_partial, local_assigns
          - if additional_buttons.try(:strip).present?
            %li= additional_buttons
        - dropdown_dom_id = "#{dom_id(post)}__chevron-buttons"
        - if chevron_dropdown.try(:strip).present?
          .post-card-with-comments__buttons
            %button.btn.btn-link.btn-sm.dropdown-toggle{ id: dropdown_dom_id, "aria-expanded": "false", "aria-haspopup": "true", "data-toggle": "dropdown" }
              %i.fa.fa-chevron-down
            %ul.dropdown-menu.pull-right{ "aria-labelledby": dropdown_dom_id }
              = chevron_dropdown
        .post-info
          = render 'users/post_byline', post: post

        = render 'posts/post_line', local_assigns.merge(show_issue: false)


      - share_partial = capture do
        = render 'application/share', providers: %w(facebook twitter telegram kakao-link kakao-story copy), share_map: {action: 'parti-share', 'share-url': polymorphic_url(post, subdomain: post.issue.group_subdomain), 'share-text': "#{post.specific_desc_striped_tags.try(:truncate, 100)} | #{post.issue.group.try(:share_site_title) || "빠띠"}", 'share-image': "#{post.meta_tag_image}" }
      .post-card-with-comments__footer.clearfix
        %span.post-card-with-comments__footer__upvote
          .post-upvote
            = render 'upvotes/upvote', upvotable: post

        - if user_signed_in?
          %span.post-card-with-comments__footer__link-to-modal{data: { action: 'parti-focus', 'focus-target': new_comment_form_body_input_dom_selector(post)}}
            댓글달기
        - else
          %span.post-card-with-comments__footer__link-to-login{data: { toggle: 'parti-login-overlay', label: '댓글달기' }}
            댓글달기
        %span.post-card-with-comments__footer__share-modal{"data-url": "#share-partial-#{dom_id(post)}", "data-action": "parti-popover", "data-placement": "top"}
          공유하기
        %span.post-card-with-comments__footer__upvote-count
          = render 'upvotes/upvote_count', upvotable: post
        .hidden
          .share-partial{id: "share-partial-#{dom_id(post)}"}
            = share_partial
      .post-reaction{class: "#{dom_id(post)}-post-reaction"}
        = render 'posts/comments', local_assigns


