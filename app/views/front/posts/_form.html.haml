-# TODO 저장 전에 폼 값 확인하기
= form_with(model: [:front, current_post], local: false, html: { class: 'post-form', novalidate: true, data: { controller: 'post-form editor-form', action: "ajax:before->post-form#submit" } }) do |f|
  = hidden_field_tag :folder_id, @current_folder&.id
  = f.hidden_field :need_remotipart, data: { target: 'post-form.remotiPartField' }
  = f.hidden_field :issue_id
  = f.hidden_field :has_poll, value: false
  = f.hidden_field :has_survey, value: false
  = f.hidden_field :has_event, value: false
  .post-meta
    = link_to smart_user_gallery_url(current_user), class: 'userimage' do
      .userimagebg{ style: "background-image: url(#{current_user.image.sm.url})" }
    .desc
      = link_to current_user.nickname, smart_user_gallery_url(current_user), class: 'usernickname'
      .createdat 지금
  .form-group
    = f.hidden_field :body, data: { target: 'post-form.bodyField' }
    %div{ style: 'display: none', data: { target: 'editor-form.source' } }
      != f.object.body
  .form-group
    .filesourcesfield{ data: { target: 'post-form.fileSourcesFieldGroup' }, class: ('-active' if current_post.file_sources.any?) }
      .main
        .images{ data: { target: 'post-form.imageFileSourcesContainer' } }
          = f.fields_for :file_sources, current_post.file_sources_only_image do |ff|
            = render 'front/posts/form/file_source_field', f: ff
        .docs{ data: { target: 'post-form.docFileSourcesContainer' } }
          = f.fields_for :file_sources, current_post.file_sources_only_doc do |ff|
            = render 'front/posts/form/file_source_field', f: ff
      .footer.clearfix
        .btn.btn-secondary.btn-sm{ data: { target: 'post-form.addFileSourceFieldButton', action: 'click->post-form#addFileSourceField' } }
          + 파일 추가
          %span.counter
            (
            %span{ data: { target: 'post-form.fileSourcesCounter' } }<> 0
            \/
            %span<> 20
            )
        .btn.btn-link.btn-sm.text-muted{ data: { action: 'click->post-form#closeFileSourcesFieldGroup' } } 업로드 취소

        .template{ data: { target: 'post-form.fileSourceFieldTemplate' } }
          = escape_once_block do
            = f.fields_for :file_sources, FileSource.new(), child_index: 'NEW_RECORD' do |ff|
              = render 'front/posts/form/file_source_field', f: ff
        .template{ data: { target: 'post-form.imageFileSourcePreviewTemplate' } }
          = escape_once_block do
            = render 'front/posts/form/file_source_preview', file_source: FileSource.new(), type: :image
        .template{ data: { target: 'post-form.docFileSourcePreviewTemplate' } }
          = escape_once_block do
            = render 'front/posts/form/file_source_preview', file_source: FileSource.new(), type: :doc
      .helper.text-muted
        %hr
        %span.badge.badge-secondary TIP
        최대 크기 10M 파일을 20개까지 업로드할 수 있습니다. 이미지는 드래그해서 순서를 조정할 수 있습니다.
    %button.btn.btn-xs.btn-link{ data: { action: 'click->post-form#openFileSourcesFieldGroup'} }
      %i.fa.fa-cloud-upload
      = t('labels.new_post_file_source_button')

  .form-group
    = f.submit '게시', class: 'btn btn-primary btn-block', data: { disable_with: "게시 중..." }